suite: test nominal HPA
templates:
  - hpa.yaml
tests:
  - it: HPA nominal CPU should work
    values: 
    - ../../../helm/tests/testcases/deployment/nominal.yaml
    - ../../../helm/tests/testcases/product/nominal.yaml
    - ../testcases/component/base.yaml
    - ../testcases/component/hpa/nominal.yaml
   
    asserts:
      - isKind:
          of: HorizontalPodAutoscaler
      - isAPIVersion:
          of : autoscaling/v2
      - matchRegex:
          path: metadata.name
          pattern: "api-demo"
      - equal:
          path: spec.minReplicas
          value: 7
      - equal:
          path: spec.maxReplicas
          value: 15
      - equal: 
          path: spec.metrics[0].resource.name
          value: "cpu"
      - equal: 
          path: spec.metrics[0].resource.target.averageUtilization
          value: 53
